<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: changeTrust.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: changeTrust.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * changeTrust function
 *
 * @constructor
 * @param {string} privKey - The private key of the account.
 * @param {string} memoType - The type of memo the transaction that you want create (text,id,return)
 * @param {string} memo - The content of memo the change trust transaction that you want create (text,id,return)
 * @param {string} issuer - The public key of the issuer 
 * @param {string} assetCode - The assetCode of the asset that you want to trust
 * @param {string} trustLimit - The amount of coin that you want to trust from this issuer
 * @author Andrea Borio andrea.borio@outlook.com
 * 
 */

async function changeTrust(privKey, issuer, assetCode, trustLimit, memoType, memo, env) {
  return new Promise((resolve, reject) => {
    var global = require('../global')
    global.test()
      .then(function (global) {
        let server,StellarSdk
        if (typeof env != 'undefined' &amp;&amp; env === "testnet") {
          server = Object.assign( Object.create( Object.getPrototypeOf(global.testnet.server)), global.testnet.server)
          StellarSdk = Object.assign( Object.create( Object.getPrototypeOf(global.testnet.StellarSdk)), global.testnet.StellarSdk)
        }
        else{
         server = Object.assign( Object.create( Object.getPrototypeOf(global.public.server)), global.public.server)
         StellarSdk =  Object.assign( Object.create( Object.getPrototypeOf(global.public.StellarSdk)), global.public.StellarSdk)
        }
        var memoFinal;
        switch (memoType) {
          case 'text':
            memoFinal = StellarSdk.Memo.text("ok")
            break;
          case 'id':
            memoFinal = StellarSdk.Memo.id(memo)
            break;
          case 'return':
            memoFinal = StellarSdk.Memo.return(memo)
            break;
          default:
            reject('invalid memo type')
            break;
        }
        let des = StellarSdk.Keypair.fromSecret(privKey)
        server.loadAccount(des.publicKey())
          .catch(StellarSdk.NotFoundError, function (error) {
            reject({
              message: 'The destination account for change_trust_op doesn\'t exists.',
              errCode: 404
            });
          })
          .then(function (sourceAccount) {
            let asset = new StellarSdk.Asset(assetCode, issuer)
            transaction = new StellarSdk.TransactionBuilder(sourceAccount)
              .addOperation(StellarSdk.Operation.changeTrust({
                asset: asset,
                limit: trustLimit
              }))
              .addMemo(memoFinal)
              .build();
            transaction.sign(des);
            return server.submitTransaction(transaction)
          })
          .then(function (result) {
            resolve(result)
          })
          .catch(function (error) {
            reject('Tx error_' + error)
          })


      })
  })
}
module.exports = {
  changeTrust
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="changeTrust.html">changeTrust</a></li><li><a href="createAccount.html">createAccount</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jan 10 2019 11:12:38 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
